# cub 3d
> 이번 프로젝트에서는, mlx함수의 이용방법과 ray casting에 대해서 공부한다.

## ray casting

### 1. 플레이어의 초기값 설정, 회전행렬 그리고 FOV (플레이어의 벡터와 카메라 벡터를 이용하여)
> player dir의 방향과 camera plane	의 벡터가 수직이되게 만들어야한다. 또한 처음 길이를 주어 FOV가 60도를 이루도록한다.
처음 플레이어의 방향은 왼쪽을 향한다. (각도가 0도 이므로) 
그 이후, rotation함수(회전행렬)을 이용하여, 수직으로 맞춰놓은 두개의 백터를 각도에 따라 이동시킨다.
즉,
``` c

player_dir_x = -1;
player_dir_y = 0;

camera_plane_x = 0;
camera_plane_y = 0.66;

```

|\
|  \
- -<-p  즉 p(플레이어)의 왼쪽으로가는 방향이 dir_x의 값 (-1), 위로 올라가는 방향이 camera_plane_y (0.66), 즉 저렇게 벌어진 각도는 대락 66.xx이다.
|  /
|/

회전행렬을 쓰기위해, 각도 1도의 값을 구해야하는데, PI값과 180을 이용해서구함. 180도는 PI이므로, 1도는 PI/180 이다.
이 각도를 sin과 cos의 값에 넣어서 회전행렬값을 구한다.

### 2. delta, side 값
> delta_x, delta_y는 각 그리드를 1씩 레이의 방향으로 x, y가 옮겨졌을때, 그에 따른 ray의 규칙적인 증가값이다.
ray는 직선이므로, 각 x또는 y가 1씩 그리드상에서 증가했을때, 같은 비율로 ray의 값도 벽과 만날때까지 증가한다.
이건, ray의 방향과 x의축을 이용한 삼격형을 참고하여, 비율로 구한다.

### 3 ray와 유클리드값
side_x, side_y는 초기값은 ray가 첫 x또는 y의 좌표와 만났을경우의 값이며, 그 이후에는 delta값을 더하여 완성된다.

	|   p  	|		| 		|		| 
	|	p--	|======	|======	|======	|  --는 초기 side값을, 그리고 =====는 일정한 delta값을 의미한다

		p--------------------------   ray에 의한 side값

이렇게 구한 side로 dda알고리즘을 이용하여, 벽과만난다며, 그길이를 유클리드 값이라 칭한다.

### 3. 카메라평면과 벽과의 거리
> 이렇게 구한 유클리드값을 이용하여, 벽과 수직으로 만나는 실제 ray casting에 필요한 값을 구해야한다.

					========
					|		|
					=========
					\   |
				   1  \	| 2 
		================p====================

1과 2는 같은 벽에 쏘여지는 ray이지만, 길이가 다르기때문에, 우리가 카메라로 정면에있는 벽을 본다면, 우리는 다른 ray값에 의해서 가운데가 제일높은
벽을 보게된다.

이러한 현상을 막기위해서, 1과 벽이 만나는 점에서, 카메라 평면에 직각으로 내려오는 선의 길이를 구해서 레이캐스팅을 해야한다. 이 선은 2와 길이가 같다.

### 4. 스크린상에서의 벽의 높이
> 스크인상에서의 벽에높이를 구하기위해서, 우리는 우리가 보는 스크린의 세로길이 h와 실제 레이가 카메라평면과 수직인 길이 pre를 가지고
각 픽셀이 어디서부터 어디까지 strip으로 표현되는가를 구한다.

### 5. render buf
> mlx를 이용하여, 픽셀을 찍는건, 그만큼의 buf를 만들어서 구현해야한다. 각각을 구하며 render를 하는건 너무 많은 자원과 시간을 쓴다.
1. buf를 스크린의 높이과 넓이만큼 할당한다.
2. buf에 위쪽의 반은 ceiling, 아래쪽 반은 floor의 색으로 채운다.
3. 각 x값(x는 스크인의 넓이의 픽셀 수이다. 0부터(왼쪽) 시작하여, 끝까지(오른쪽) x에 따른 레이캐스팅값(strip)을 buf에 저장한다.

### 6. render
> 이미 만들어놓은 buf를 mlx함수를 이용하여, rendering 한다.

## 그외 부분
> 
1. 파일 format확인, fd 확인
2. texture.xpm 이미지로의 전환
3. key값 받아서, player 위치 옮기기
4. leaks 확인
